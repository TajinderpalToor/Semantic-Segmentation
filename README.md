\documentclass[journal]{IEEEtran}
\usepackage{epsf,cite,amsmath,amscd,graphics,graphicx,latexsym,multicol,setspace}
\usepackage{amsfonts,amsmath,amssymb,amsthm}
\usepackage{scalefnt}
\newcounter{MYtempeqncnt}
\begin{document}
\title{Forecasting Stock Closing Prices using Stacked LSTM Models to create Optimal Portfolios  }

\author{Tajinderpal Toor\\
ttoor@torontomu.ca\\
Electrical and Computer Engineering Graduate Student\\
Toronto Metropolitan University, Toronto, Canada.}
\maketitle
\begin{abstract}
The stock market is a vital part of the economy ,giving individuals the ability to invest in companies in order to help meet their financial goals.  Due to numerous factors the market can be extremely volatile and can potentially result in a loss of funds. Therefore it is important to be prepared for fluctuations in the market by having an optimal portfolio. By calculating the performance of selected investments, the potential downside can be estimated. Through the use of Long Short Term Memory and Convolutional Neural Networks, this paper proposes an architecture which will forecast prices and create an optimal portfolio. The historical data from January 2017 to December 2022  of the top twenty holdings of the Vanguard Growth ETF will be used to forecast performance. The top k performing stocks will be chosen and optimal portfolios will be created where the performance of a long term buy and hold strategy vs a short term trading strategy will be discussed and compared to overall market growth. 

\end{abstract}
\begin{IEEEkeywords}
Long Short Term Memory Network , Time Series Data, Convolutional Neural Networks, Stock price Forecasting
\end{IEEEkeywords}

\section{Introduction}
\label{intro}
The stock market is a vital part of the world economy. Through the stock market individuals can invest in companies with the hopes of achieving growth. By investing in the market, one can protect themselves against inflation and grow their money till their individual goals are met.  Although investing in the market has numerous benefits the risk involved is a huge factor into why some individuals hesitate to invest their savings. Due to the ever shifting economy, political affairs and other factors, the markets tend to be very volatile and one's money can potentially be at risk. In order to protect oneself from the market, they must be educated on the performance of their chosen portfolio. Being able to predict the performance of a portfolio or chosen stock, will allow the customer to choose an investment that can produce maximal results within their risk tolerance.  Throughout the years, there has been an increase in the use of deep learning to help predict the performance of companies. Recurrent neural networks, specifically the Long short term memory architecture has been used to process the sequential time series stock data to perform accurate forecasting of historical data. This paper proposes a hybrid method which uses two common architectures: the LSTM and CNN to perform accurate predictions on a pool of investments and create an optimal portfolio which is tested to estimate its potential earnings. 

\section{Literature Review}

Designing and managing a portfolio can be considered an optimization problem where capital is being allocated to a set of assets. The goal of portfolio design is to allocate assets in a way where returns are maximized and risk is minimized. Authors in [1] Stock Portfolio Optimization Using a Deep Learning LSTM Model constructed an optimum portfolio for nine sectors of the Indian economy. Nine sectors were identified and the stocks of the companies that had the most significant impact to each sector were used to create portfolios. The nine sectors were: pharmaceuticals,infrastructure, realty, media, public sector banks, private sector banks, large cap, mid cap and small cap. This paper built a regression model using LSTM architecture to predict the price of each stock.  The LSTM model used the past 50 days as the time series input, specifically the model took in daily close price as its input.  The model in total had two LSTM layers, with a dropout of thirty percent to prevent overfitting.  Through grid search it was found that the optimum epoch was 100 and the optimum batch size was 64. 

Researchers at MIT ADT University in India proposed hybrid networks and a stacked LSTM model to predict stock prices. In [2], Stock Market Prediction and Portfolio Optimization researchers discussed  using a Hybrid 1D-Convolutional Layer LSTM, GRU-LSTM model and a conventional stacked LSTM.  The stock prices of SBI, Indian Bank and Bank of India are all predicted using these methods and compared to see which offers the best performance.  The Stacked LSTM model gives good precision but is seen to be computationally expensive. The stacked LSTM is essentially just having multiple LSTM layers and a dense layer as an output. Stacking LSTM layers makes the model more complex and allows it to create more complex features and learn more complex patterns.  This model takes in the input and passes it to a LSTM layer with 100 nodes, the output of this layer is fed to another LSTM layer with 50 nodes, which is then fed to another LSTM layer with 150 nodes and finally to an LSTM layer with 100 nodes.  Next researchers discussed the Hybrid 1D-Convolutional Layer LSTM. The 1D convolutional layer extracts the most common and essential features. The input is passed through a 1d-convolutional layer with 32 filters then to another 1d convolutional layer with 64 filters then to a LSTM with 150 nodes then to a 1d-convolutional layer with 128 filters then finally through a LSTM with 100 nodes before being flattened and passed to a dense layer. Finally the GRU-LSTM model was introduced.  In this model the input is passed to a gru with 256 nodes, then a dropout of 0.4 is applied, passed to LSTM with 256 nodes then to dropout of 0.4 then dense layers(64) then flattened before being passed to another dense layer. 


In [3], researchers from various institutions and departments presented the paper, Harnessing a Hybrid CNN-LSTM Model for Portfolio Performance: A Case Study on Stock Selection and Optimization.  This paper proposed a method which uses modern portfolio theory and deep learning to create an optimal portfolio.  This paper introduced a CNN-LSTM + MV model which would forecast stock prices using a hybrid model and then allocate the stocks in an optimal portfolio using the mean variance model. Twenty-one stocks were selected from the National Stock Exchange of India and their historical data spanning from January 2005 to December 2021. This period features two market crashes, which will allow the hybrid model to extract and learn patterns from these downturns in the market.  Convolutional Neural Networks can handle numerous channels of input data, the model can learn complicated patterns from many forms of input data. For example the input can be technical indicators, OHLC prices, or even market sentiment. OHLC prices are the daily open,high,low and close price of a stock. The output of the convolutional layer is passed to a max pooling layer before being flattened and fed to an LSTM to find long term dependencies.  The twenty one stocks that were selected are fed to the hybrid model. From here the top K stocks with the highest returns will be selected for a portfolio. Once these stocks are identified, Markowitzâ€™s mean variance model is used to find the optimal capital allocation of the stocks.  Researchers selected: Open,close,high,low,adjusted close,simple moving average,exponential moving average,relative strength index,rate of change,true range,average true range,momentum index,commodity channel index  as the inputs which includes daily stock information and various technical indicators.  The presented model had an average annualized cumulative return of 25.62%, which is greater than some of the other methods shown in this paper. 

Researchers from the Department of Computer Engineering at the Istanbul Technical University presented [4], Portfolio Construction with Stock Prices Predicted by LSTM using Enhanced Features. This paper created a portfolio construction pipeline that predicts stock prices and constructs a portfolio based on these predictions. Usually LSTM models use raw time series data, but recent studies showed that features extracted from time series data can increase the capacity of the models. This paper proposes a model which takes in raw stock price data, such as opening price, closing price, highest price and lowest price to create candlestick charts.  Through the use of an autoencoder, semantic information can be extracted from these images. The vector produced from this step is concatenated with the closing price to create a vector which is fed to the LSTM. The candlestick charts created had data from the previous twenty days.  The LSTM forecasted the closing price at the end of the next day. These forecasted prices were used to calculate returns and make a portfolio featuring stocks with the highest returns. The portfolio created featured the highest performing stocks as per calculated from the proposed LSTM with enhanced feature model. This portfolio was compared to other portfolio strategies such as the 1/N method, Sharpe Ratio and LSTM with raw series and had the greatest daily mean return. 

In [5], researchers presented Multivariate Regression Analysis for Stock Market price prediction using Stacked LSTM.  This paper presented a model which uses a Stacked LSTM to forecast future stock prices at high accuracy. Researchers tested their model on data from the Dhaka Stock Exchange.  This paper proposed a MultiVariate LSTM model which takes in multiple feature variables and shows how a deeper LSTM can handle the variability of the stock market better.  The proposed model in this paper outperformed single layer LSTM which illustrated that a deep architecture is more robust to learn extreme variability. The model featured three hidden LSTM layers, where the output of one LSTM layer is the input of the next LSTM layer. Following this there is a dropout of 0.5 and a dense layer. The LSTM layers were fifty units each.  The authors of this paper used Open, Close, High, Low as the inputs into the model. To show that the multivariate LSTM architecture performed better than the univariate, authors first used each of the features separately to perform a univariate model and calculated the RMSE. It was shown that as the number of features increases the RMSE value lowers. For example using close as the single feature input, the RMSE value is 58.57, when two input features (Close,Open) were used the RMSE becomes 57.32 and finally when all four features are used the RMSE becomes 52.41. 

Researchers from Bangladesh, presented a paper [6],  Predicting Stock Market Price: A Logical Strategy using Deep Learning which uses frequently used algorithms to create a prediction model that forecasts the price of a stock. This paper compared the performance of the Long Short Term, Extreme Gradient Boosting (XGBoost), Linear Regression, Moving Average and Last Value Model on twelve months of historical data for the Dhaka Stock Exchange. The historical data contained 236 data points between January 2019 to December 2019. The attributes researchers used to train their model are date, opening price, high, low,closing price and adjacent close. In this architecture the authors use two LSTM layers, where there is a dropout in between each layer and finally the output is passed through a dropout before being fed to the dense classifier.  To evaluate the model, Mean Absolute Percentage Error is used where the lower the MAPE the better the result is. The LSTM model had a MAPE of 0.635, which outperformed all the other algorithms. 


In [7], Intraday Stock Trading Strategy Based on Analysis Using Bidirectional Long Short-Term Memory Networks, researchers proposed a hybrid model with a Convolutional Neural Network and Bidirectional Long Short-Term Memory to forecast prices and generate stock trading signals. The model was used to predict the prices of 12 Stocks, AMD, APA, DVN, GOOGL, MOS, MRNA, NFLX, NVDA, OXY, SQQQ, TQQQ, and TSLA using technical indicators. This study took historical data from 2019 to 2022 and used the pening price, highest price, lowest price, closing price, and trading volume for each day to calculate the technical indicators.  This data was split into training,validation and testing data where the training data was the first three weeks of the month, validation is the following week and the testing data is the year after the validation.  The Bidirectional LSTM captures dependencies in both the forward and backward direction, the input sequence is processed in forward and backward direction with two separate hidden layers and outputs from both directions are combined. This paper investigated 4 different configurations: CNN-LSTM, LSTM-CNN ,CNN-BILSTM and BILSTM-CNN. The CNN-LSTM has an  input layer, convolutional  layer,dropout layer, LSTM layer, flatten layer, batch normalization, dense layer and output layer. The LSTM-CNN has an  input layer,lstm layer,dropout layer,convolutional layer,flatten, batch normalization, dense layer and finally an output layer. The BILSTM-CNN has an input layer, BILSTM layer, dropout layer, convolutional layer, flatten layer, batch normalization and dense layer. Finally the CNN-BILSTM has an  input layer , convolutional layer, dropout, BILSTM layer ,flatten,batch normalization, dense, and an output layer. The number of filters used in the cnn layer is : 32,64,128,256 and of nodes in lstm: 32,64,128,256 with a batch size of 32. 



Wenjian Zheng from China authored a paper [8], Exchange-Traded Fund Price Prediction Based on the Deep Learning Model which investigated using a LSTM model and CNN-BiLSTM model to predict the next day price of an ETF. ETFs or exchange traded funds are a popular investment which allows customers to buy a pool of shares. ETFs are essentially a basket of shares and usually mimic the performance of stock indices. The models will predict the price of the next day and then from there it can be determined if the fund should be bought or not.  This study used the opening price, highest, lowest,closing price, change and other technical indicators as features.  The models were trained and evaluated on the Shanghai 50 exchange-traded securities investment fund where the daily trade data of 3500 trading days is used as data. The LSTM model has three LSTM layers, each with 128 units and a 0.2 dropout. On the other hand the CNN-BiLSTM--AM architecture had a convolutional layer with 256 filters, max pooling layer, 0.2 dropout, BILSTM with 256 units an attention mechanism and a dense layer.  The Attention Mechanism is used to capture the effect of characteristic status on the highest price which increases prediction accuracy. 

In paper [9], researchers from the Department of Computer Science and Engineering at the G.H Raisoni College of Engineering, present a method of forecasting stocks through the use of technical indicators and LSTM is used. The objective of this study was to enhance profitability and minimize the potential losses in trading. In this study, Algorithmic Trading Strategy Using Technical Indicators the first step is to collect the historical price of the NIFTY 50 index. This data included the open, high, low, and close prices for each trading day. This data is then used to calculate technical indicators such as supertrend, fibonacci pivot points, average directional index as features. Following this, the study  defined the trading strategy. A buy signal is generated when the adx>20 which represents a strong trend, price above supertrend line and the current price above fibonacci pivot point. On the other hand a sell signal is generated when adx>20, price crosses below supertrend line and the current price is below fibonacci pivot point. The architecture used in this model had 3 LSTM layers and 1 dense layer. This strategy was used in options trading and generated a profit of 1.5 lakhs in options trading over a year and a half. 

In paper [10], Tonghui Li from Tianjin University of Commerce, presented a method to predict the price of bitcoin using a LSTM model and multi-feature LSTM.  Being able to accurately predict the price of bitcoin can reduce investors risk and eliminate trader concerns which may better facilitate the circulation of bitcoin in the market.  This paper uses the daily open, high,low,close,volume and weighted prices of bitcoin between Jan 7th 2014 and October 17th 2017 as input to its model.  Furthermore the model used would predict the weighted price of bitcoin using single features and multiple features. After training the single feature model produced an RSME of 121.333 while the multi feature model had an RMSE of 90.136.

\label{related}


\section{Problem Statement}
\label{sysmo}
This paper aims to forecast the prices of high growth stocks. A pool of stocks will be taken from a commonly known Exchange traded fund and forecasted through the proposed model. From this pool, the best performing k stocks will be placed in an optimal portfolio determined by modern portfolio theory. The performance of this portfolio will be tested by a buy and hold long term strategy and a shorter term trading signal with defined buy and sell signals.  For the long term buy and hold strategy features will be common elements used in fundamental analysis, vs for the short term trading strategy inputs will feature technical indicators and general stock information(open,close,high,low,etc).

\section{System Model}
\label{sysmo}

In this paper I will be using a Hybrid LSTM model, consisting of an LSTM and other architectures which will be chosen after further testing. Furthermore, this paper will be using a Bi Directional multi feature  LSTM combined with  a Convolutional Neural Network.

Long short-term memory (LSTM) is a special kind of  recurrent neural network (RNN) that deals with the vanishing gradient problem and excels at learning long term dependencies in sequences.  A conventional LSTM unit consists of a cell, input gate, output gate and forget gate. The three gates are used to control the information flow (information stored, written or read) of the cell.  The LSTM uses sigmoid and Tanh activation functions. The Tanh is a non linear activation function that regulates the values flowing through the network. It can take on values between -1 and 1.  On the other hand, the sigmoid function keeps the value between 0 and 1. This helps the network to either forget or know which data to keep. If the result of multiplying by sigmoid is 0, the information is forgotten, but if the result is 1 the information stays 1. The forget gate will help decide which bits of the cell state are useful given the previous hidden state and new input data. This data is passed through a sigmoid function which will give a value between 0 and1. If the output is close to 0, the component of the input is irrelevant and vice versa if output is closer to 1. This result will then be multiplied with the previous cell state, which will tell us which components to ignore or have less influence. Essentially the forget gate helps decide which components should be given less weight.  


The input gate decides what new information should be added (ie. updating the cell)  to the cell state given the previous hidden state and new input data.

 Using a tanh activation function allows the architecture to combine the previous hidden state and the new input data to generate a vector which tells the architecture how much to update each component of the cell given new data. This vector is called the â€˜new memory update vectorâ€™ and has values between -1 and 1 where a negative value means the architecture needs to reduce the implant of a certain component.  The input gate then helps decide which of the updates are worth keeping through the use of a sigmoid function.  The output of the sigmoid is multiplied by the vector and added to the cell state, which will update only the selected components. 
Finally the output gate decides the new hidden state using the previous hidden state, new input data and newly updated cell state. Through the use of a sigmoid function only the necessary information is outputted. In summary the forget gate helps decide which information is unnecessary, the input gate helps to determine which components should be updated and by how much, finally the output gate helps determine which of the components need to be outputted and which don't. 


On the other hand, the hybrid architecture will also feature a convolutional neural network. The convolutional neural network uses filters to create feature maps. By applying certain filters to inputs, you can create a feature map which will summarize the features specified present in the input. For example, filters can be line detectors which when applied will produce a feature map which will specify the location of lines within the input.  Convolutional Neural Networks can recognize non linear patterns in data which is extremely important in stock time series as the prices can be affected by a wide range of variables and can experience numerous different patterns. 


When combining a CNN and LSTM,  complex features can be extracted from the multi feature input data using the Convolutional Neural Network.  Furthermore, this processed data can be flattened and sent to a LSTM to identify long term sequential dependencies. Together these architectures can be combined to produce accurate and highly confident results.



\begin{thebibliography}{10}

 \bibitem
J. Sen, A. Dutta and S. Mehtab, "Stock Portfolio Optimization Using a Deep Learning LSTM Model," 2021 IEEE Mysore Sub Section International Conference (MysuruCon), Hassan, India, 2021, pp. 263-271, doi: 10.1109/MysuruCon52639.2021.9641662. 

\bibitem
A. Gondkar, J. Thukrul, R. Bang, S. Rakshe and S. Sarode, "Stock Market Prediction and Portfolio Optimization," 2021 2nd Global Conference for Advancement in Technology (GCAT), Bangalore, India, 2021, pp. 1-10, doi: 10.1109/GCAT52182.2021.9587659.

\bibitem
P. Singh, M. Jha, M. Sharaf, M. A. El-Meligy and T. R. Gadekallu, "Harnessing a Hybrid CNN-LSTM Model for Portfolio Performance: A Case Study on Stock Selection and Optimization," in IEEE Access, vol. 11, pp. 104000-104015, 2023, doi: 10.1109/ACCESS.2023.3317953.

\bibitem
M. L. Ã–zbilen and Y. Yaslan, "Portfolio Construction with Stock Prices Predicted by LSTM using Enhanced Features," 2021 6th International Conference on Computer Science and Engineering (UBMK), Ankara, Turkey, 2021, pp. 639-643, doi: 10.1109/UBMK52708.2021.9558889.

\bibitem
R. Uddin, F. I. Alam, A. Das and S. Sharmin, "Multi-Variate Regression Analysis for Stock Market price prediction using Stacked LSTM," 2022 International Conference on Innovations in Science, Engineering and Technology (ICISET), Chittagong, Bangladesh, 2022, pp. 474-479, doi: 10.1109/ICISET54810.2022.9775911.

\bibitem
M. Biswas, A. Shome, M. A. Islam, A. J. Nova and S. Ahmed, "Predicting Stock Market Price: A Logical Strategy using Deep Learning," 2021 IEEE 11th IEEE Symposium on Computer Applications & Industrial Electronics (ISCAIE), Penang, Malaysia, 2021, pp. 218-223, doi: 10.1109/ISCAIE51753.2021.9431817.

\bibitem
P. Pholsri and P. Kantavat, "Intraday Stock Trading Strategy Based on Analysis Using Bidirectional Long Short-Term Memory Networks," 2023 6th International Conference on Artificial Intelligence and Big Data (ICAIBD), Chengdu, China, 2023, pp. 572-578, doi: 10.1109/ICAIBD57115.2023.10206361.
\bibitem
W. Zheng, "Exchange-Traded Fund Price Prediction Based on the Deep Learning Model," 2021 China Automation Congress (CAC), Beijing, China, 2021, pp. 7429-7434, doi: 10.1109/CAC53003.2021.9727762.

\bibitem
P. Kumbhare, L. Kolhe, S. Dani, P. Fandade and D. Theng, "Algorithmic Trading Strategy Using Technical Indicators," 2023 11th International Conference on Emerging Trends in Engineering & Technology - Signal and Information Processing (ICETET - SIP), Nagpur, India, 2023, pp. 1-6, doi: 10.1109/ICETET-SIP58143.2023.10151614.

\bibitem
T. Li, "Prediction of Bitcoin Price Based on LSTM," 2022 International Conference on Machine Learning and Intelligent Systems Engineering (MLISE), Guangzhou, China, 2022, pp. 19-23, doi: 10.1109/MLISE57402.2022.00012.

\end{thebibliography}
\end{document}

